<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Price grabber</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.8.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.8.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.8.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.8.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.8.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2013-12-16T17:27:02-05:00">2013-12-16T17:27:02-05:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">96.97%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4.05
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>10</b> files in total.
    <b>693</b> relevant lines. 
    <span class="green"><b>672</b> lines covered</span> and
    <span class="red"><b>21</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#988fff34ba8cd934245c49b6117040f6d9bf36f2" class="src_link" title="lib/price_grabber.rb">lib/price_grabber.rb</a></td>
        <td class="yellow strong">88.1 %</td>
        <td>435</td>
        <td>168</td>
        <td>148</td>
        <td>20</td>
        <td>8.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d4c2a7ccde40ea806f2c5bca7a883aa4081d2e5" class="src_link" title="lib/price_grabber/business.rb">lib/price_grabber/business.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>103</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>14.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba547746737de30efcb274de5e972dc5863062f9" class="src_link" title="lib/price_grabber/common.rb">lib/price_grabber/common.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>49</td>
        <td>16</td>
        <td>15</td>
        <td>1</td>
        <td>1.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a05a477425e7d218e860945f0b5382e916d107be" class="src_link" title="lib/price_grabber/config.rb">lib/price_grabber/config.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e83a158da22654039fa2728c51ad12513ab4616d" class="src_link" title="spec/common_spec.rb">spec/common_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>64</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f28ab6f6a399bfd5f6a61195dec4bc28a528262b" class="src_link" title="spec/get_service_rate_spec.rb">spec/get_service_rate_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>208</td>
        <td>124</td>
        <td>124</td>
        <td>0</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1b39cbb93f40cde59a02bcd887e446c4669ccb74" class="src_link" title="spec/get_service_request_rates_spec.rb">spec/get_service_request_rates_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>167</td>
        <td>107</td>
        <td>107</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#affa4b85a5752db87f066c94e40508e784f4eb25" class="src_link" title="spec/get_ssr_rates_spec.rb">spec/get_ssr_rates_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>147</td>
        <td>89</td>
        <td>89</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b3dc88bdf5df771558108802bc87c2f3a275e80c" class="src_link" title="spec/price_grabber_spec.rb">spec/price_grabber_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>80</td>
        <td>41</td>
        <td>41</td>
        <td>0</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#844c6afbf498084c2b84af21047d648885d045fd" class="src_link" title="spec/rates_on_date_spec.rb">spec/rates_on_date_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>115</td>
        <td>51</td>
        <td>51</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.8.2 
        and simplecov-html v0.8.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="988fff34ba8cd934245c49b6117040f6d9bf36f2">
  <div class="header">
    <h3>lib/price_grabber.rb</h3>
    <h4><span class="yellow">88.1 %</span> covered</h4>
    <div>
      <b>168</b> relevant lines. 
      <span class="green"><b>148</b> lines covered</span> and
      <span class="red"><b>20</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;price_grabber/version&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;rest_client&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;time&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;price_grabber/config&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;price_grabber/common&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;price_grabber/business&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">module PriceGrabber</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # Hash map for funding rates to percentages</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  RATE_LOOKUP = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    &quot;full_rate&quot;      =&gt; &quot;full&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    &quot;federal_rate&quot;   =&gt; &quot;federal&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    &quot;corporate_rate&quot; =&gt; &quot;corporate&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    &quot;other_rate&quot;     =&gt; &quot;other&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    &quot;member_rate&quot;    =&gt; &quot;member&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # Retrieves the rate for the given service on the given project.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # Should only be used in the instance that you are retrieving a single service&#39;s rate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # rather than retrieving the rates for all the services on a service_request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # or sub_service_request.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  # Returns the rate for the service, an integer number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_service_rate service_id, project_id, data_source=PriceGrabber::Common</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="26">
          <span class="hits">9</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      # Get the service and project</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="28">
          <span class="hits">9</span>
          
          <code class="ruby">      service = data_source.get(&quot;services/#{service_id}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="29">
          <span class="hits">9</span>
          
          <code class="ruby">      project = data_source.get(&quot;projects/#{project_id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      # Get the organization</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="32">
          <span class="hits">9</span>
          
          <code class="ruby">      organization = PriceGrabber.determine_organization(service, data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      # Get the correct pricing_map</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="35">
          <span class="hits">9</span>
          
          <code class="ruby">      pricing_map = PriceGrabber.find_pricing_map(service)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      # Get the correct pricing_setup</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="38">
          <span class="hits">8</span>
          
          <code class="ruby">      pricing_setup = PriceGrabber.find_pricing_setup(organization)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      # Get the funding source of the project</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="41">
          <span class="hits">7</span>
          
          <code class="ruby">      funding_source = PriceGrabber.determine_funding_source(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      # Compare funding source against rates mapping on pricing_setup</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="44">
          <span class="hits">7</span>
          
          <code class="ruby">      selected_rate_type = PriceGrabber.determine_applicable_rate(pricing_setup, funding_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      # See if the rate is overriden, if it is, return that overridden value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      # Also returns the full_rate when the full rate is specified.</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="48">
          <span class="hits">7</span>
          
          <code class="ruby">      rate = PriceGrabber.determine_rate(pricing_map, pricing_setup, selected_rate_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="50">
          <span class="hits">7</span>
          
          <code class="ruby">      return rate</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">    rescue ArgumentError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">      if e.message ==  &quot;Organization has no pricing setups!&quot; || e.message == &quot;Organization has no current pricing setups!&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">        return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">        raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  # Retrieves all the rates for the services on a specific sub_service_request on a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  # specific service_request.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  # Should be used in the instance that you know you are retrieving all the prices for a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # sub_service_request, for example in fulfillment.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  # Returns a hash of {:service_id =&gt; rate, :service_id =&gt; rate, ...}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  # where :service_id is the id of each service, and the rate is an integer number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_ssr_rates service_request_id, sub_service_request_id, data_source=PriceGrabber::Common</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    # Get the service_request, project, and the project&#39;s funding_source/potential_funding_source</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="68">
          <span class="hits">4</span>
          
          <code class="ruby">    service_request = data_source.get(&quot;service_requests/#{service_request_id}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="69">
          <span class="hits">4</span>
          
          <code class="ruby">    unless service_request[&quot;sub_service_requests&quot;][&quot;#{sub_service_request_id}&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      raise ArgumentError, &quot;No sub_service_request with id #{sub_service_request_id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="72">
          <span class="hits">4</span>
          
          <code class="ruby">    project = data_source.get(&quot;projects/#{service_request[&quot;project_id&quot;]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="73">
          <span class="hits">4</span>
          
          <code class="ruby">    funding_source = PriceGrabber.determine_funding_source(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Assemble the ssr_rates hash and return it</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="76">
          <span class="hits">4</span>
          
          <code class="ruby">    PriceGrabber.assemble_ssr_rates_map(service_request, sub_service_request_id, funding_source, data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # Retrieves all the ratess for the services on a given service_request.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # Should be used in the instance that you know you are retrieving the pricing for an</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # entire service_request, for example in the review view.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  # Returns a hash of {:service_id =&gt; rate, :service_id =&gt; rate, ...}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  # where :service_id is the id of each service, and the rate is an integer number of cents</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_service_request_rates service_request_id, data_source=PriceGrabber::Common</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    # Get the service_request, project, and the project&#39;s funding_source/potential_funding_source</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="86">
          <span class="hits">4</span>
          
          <code class="ruby">    service_request = data_source.get(&quot;service_requests/#{service_request_id}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="87">
          <span class="hits">4</span>
          
          <code class="ruby">    project = data_source.get(&quot;projects/#{service_request[&quot;project_id&quot;]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="88">
          <span class="hits">4</span>
          
          <code class="ruby">    funding_source = PriceGrabber.determine_funding_source(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    # Get sub_service_request ids of the service_request</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="91">
          <span class="hits">12</span>
          
          <code class="ruby">    sub_service_request_ids = service_request[&quot;sub_service_requests&quot;].map {|k,v| k}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # Initialize empty service_request rates_map</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="94">
          <span class="hits">4</span>
          
          <code class="ruby">    service_request_rates = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    # Iterate over sub_service_request ids and asemble ssr_rates_maps</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="97">
          <span class="hits">4</span>
          
          <code class="ruby">    sub_service_request_ids.each do |ssr_id|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="98">
          <span class="hits">8</span>
          
          <code class="ruby">      service_request_rates.merge!(PriceGrabber.assemble_ssr_rates_map(service_request, ssr_id, funding_source, data_source))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="101">
          <span class="hits">4</span>
          
          <code class="ruby">    return service_request_rates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  # Retrieves the correct pricing_map for a service based on the current date and the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  # pricing_map&#39;s display date.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  # Returns a pricing_map.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_pricing_map service, date=nil</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="108">
          <span class="hits">29</span>
          
          <code class="ruby">    if service[&quot;pricing_maps&quot;] &amp;&amp; !service[&quot;pricing_maps&quot;].empty?</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="109">
          <span class="hits">25</span>
          
          <code class="ruby">      current_date = date || Time.now.strftime(&quot;%F&quot;)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="110">
          <span class="hits">25</span>
          
          <code class="ruby">      pricing_maps = service[&quot;pricing_maps&quot;]</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="111">
          <span class="hits">25</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="112">
          <span class="hits">98</span>
          
          <code class="ruby">        current_maps = pricing_maps.select {|x| Time.parse(x[&quot;display_date&quot;]) &lt;= Time.parse(current_date)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      rescue TypeError</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">        raise TypeError, &quot;Service&#39;s pricing maps have no display dates!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="116">
          <span class="hits">25</span>
          
          <code class="ruby">      if current_maps.empty?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">        raise ArgumentError, &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="119">
          <span class="hits">51</span>
          
          <code class="ruby">        pricing_map = current_maps.sort {|a,b| b[&quot;display_date&quot;] &lt;=&gt; a[&quot;display_date&quot;]}.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="122">
          <span class="hits">24</span>
          
          <code class="ruby">      return pricing_map</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="124">
          <span class="hits">4</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Service has no pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  # Retrieves the correct pricing_map for a service based on the current date and the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  # pricing_map&#39;s effective date.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  # Returns a pricing_map.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_effective_pricing_map service, date=nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">    if service[&quot;pricing_maps&quot;] &amp;&amp; !service[&quot;pricing_maps&quot;].empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">      current_date = date || Time.now.strftime(&quot;%F&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">      pricing_maps = service[&quot;pricing_maps&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">      current_maps = pricing_maps.select {|x| Time.parse(x[&quot;effective_date&quot;]) &lt;= Time.parse(current_date)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">      if current_maps.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">        raise ArgumentError, &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">        pricing_map = current_maps.sort {|a,b| b[&quot;effective_date&quot;] &lt;=&gt; a[&quot;effective_date&quot;]}.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      return pricing_map</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">      raise ArgumentError, &quot;Service has no pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">  # Retrieves the correct pricing_setup for a service based on the current date and the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  # pricing_setup&#39;s display date.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  # Returns a pricing_setup.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_pricing_setup organization, date=nil</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="152">
          <span class="hits">29</span>
          
          <code class="ruby">    if organization[&quot;pricing_setups&quot;] &amp;&amp;!organization[&quot;pricing_setups&quot;].empty?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="153">
          <span class="hits">21</span>
          
          <code class="ruby">      current_date = date || Time.now.strftime(&quot;%F&quot;)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="154">
          <span class="hits">21</span>
          
          <code class="ruby">      pricing_setups = organization[&quot;pricing_setups&quot;]</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="155">
          <span class="hits">74</span>
          
          <code class="ruby">      current_setups = pricing_setups.select {|x| Time.parse(x[&quot;display_date&quot;]) &lt;= Time.parse(current_date)}</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="156">
          <span class="hits">21</span>
          
          <code class="ruby">      if current_setups.empty?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">        raise ArgumentError, &quot;Organization has no current pricing setups!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="159">
          <span class="hits">39</span>
          
          <code class="ruby">        pricing_setup = current_setups.sort {|a,b| b[&quot;display_date&quot;] &lt;=&gt; a[&quot;display_date&quot;]}.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="162">
          <span class="hits">20</span>
          
          <code class="ruby">      return pricing_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="164">
          <span class="hits">8</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Organization has no pricing setups!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  # Retreives a hash with rates for a service at a particular date.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  # Returns a hash of rates:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  # {&quot;full_rate&quot;      =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  #  &quot;federal_rate&quot;   =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  #  &quot;corporate_rate&quot; =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  #  &quot;other_rate&quot;     =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  #  &quot;member_rate&quot;    =&gt; Integer}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.rates_on_date service_id, date, data_source=PriceGrabber::Common</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="176">
          <span class="hits">2</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      # Get the service</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="178">
          <span class="hits">2</span>
          
          <code class="ruby">      service = data_source.get(&quot;services/#{service_id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      # Get the service&#39;s pricing_map for the specified date</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">      pricing_map = PriceGrabber.find_pricing_map(service, date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">      # Get the organization</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="184">
          <span class="hits">2</span>
          
          <code class="ruby">      organization = PriceGrabber.determine_organization(service, data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">      # Get the pricing_setup for the specified date</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="187">
          <span class="hits">2</span>
          
          <code class="ruby">      pricing_setup = PriceGrabber.find_pricing_setup(organization, date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">      # Assemble the rates map for the specified date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber.assemble_all_rates_map(pricing_map, pricing_setup)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">    rescue ArgumentError =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">      # Should an organization lack a pricing_setup assemble the rates map with nil for the service rates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">      if e.message ==  &quot;Organization has no pricing setups!&quot; || e.message == &quot;Organization has no current pricing setups!&quot; || e.message == &quot;Service has no pricing maps!&quot; || e.message == &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">          &quot;full_rate&quot; =&gt; pricing_map[&quot;full_rate&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">          &quot;federal_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">          &quot;corporate_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">          &quot;other_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">          &quot;member_rate&quot; =&gt; nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">        raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  # Retreives a hash with rates for a service (using info from organization) at a particular date and full_rate.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  # Returns a hash of rates:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">  # {&quot;federal_rate&quot;   =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  #  &quot;corporate_rate&quot; =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  #  &quot;other_rate&quot;     =&gt; Integer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  #  &quot;member_rate&quot;    =&gt; Integer}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.rates_from_full full_rate, organization_id, date, data_source=PriceGrabber::Common</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="214">
          <span class="hits">2</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">      # Get the organization</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="216">
          <span class="hits">2</span>
          
          <code class="ruby">      org = data_source.get(&quot;entities/#{organization_id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">      # Determine which organization has the pricing setup</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="219">
          <span class="hits">2</span>
          
          <code class="ruby">      organization = PriceGrabber.find_pricing_setup_organization(org, data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      # Get the pricing_setup for the specified date</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="222">
          <span class="hits">2</span>
          
          <code class="ruby">      pricing_setup = PriceGrabber.find_pricing_setup(organization, date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">      # Assemble the rates map for the specified date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber.assemble_rates_from_full(full_rate, pricing_setup)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">    rescue ArgumentError =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      # Should an organization lack a pricing_setup assemble the rates map with nil for the service rates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">      if e.message ==  &quot;Organization has no pricing setups!&quot; || e.message == &quot;Organization has no current pricing setups!&quot; || e.message == &quot;Service has no pricing maps!&quot; || e.message == &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">          &quot;federal_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">          &quot;corporate_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">          &quot;other_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          &quot;member_rate&quot; =&gt; nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">        raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">  # Determines the rate for a particular service.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">  # Returns the rate as an interger number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.determine_rate pricing_map, pricing_setup, selected_rate_type</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="246">
          <span class="hits">19</span>
          
          <code class="ruby">    if pricing_map[&quot;#{selected_rate_type}&quot;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="247">
          <span class="hits">2</span>
          
          <code class="ruby">      return_rate = pricing_map[&quot;#{selected_rate_type}&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="249">
          <span class="hits">17</span>
          
          <code class="ruby">      return_rate = PriceGrabber.calculate_rate(pricing_map, pricing_setup, selected_rate_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="252">
          <span class="hits">19</span>
          
          <code class="ruby">    return return_rate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">  # Calculate the rate for a particular service based on the percents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">  # in the pricing setup.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">  # Returns an integer number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.calculate_rate pricing_map, pricing_setup, selected_rate_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">    # Find which percentage should be applied to the full_rate to get the correct rate</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="260">
          <span class="hits">21</span>
          
          <code class="ruby">    applied_percentage = pricing_setup[PriceGrabber::RATE_LOOKUP[&quot;#{selected_rate_type}&quot;]].to_f / 100.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="262">
          <span class="hits">21</span>
          
          <code class="ruby">    if applied_percentage == 0.0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="263">
          
          
          <code class="ruby">      applied_percentage = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">    # Apply that percentage to the full_rate</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="267">
          <span class="hits">21</span>
          
          <code class="ruby">    return_rate = pricing_map[&quot;full_rate&quot;].to_f * applied_percentage.to_f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">    # Round the result</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="270">
          <span class="hits">21</span>
          
          <code class="ruby">    return_rate = return_rate.round</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">  # Calculate the rate for a particular service based on a provided full_rate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">  # and the percents on the displayed pricing_setup.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">  # Returns an interger number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.calculate_off_full full_rate, pricing_setup, selected_rate_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    # Find which percentage should be applied to the full_rate to get the correct rate</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="278">
          <span class="hits">4</span>
          
          <code class="ruby">    applied_percentage = pricing_setup[PriceGrabber::RATE_LOOKUP[&quot;#{selected_rate_type}&quot;]].to_f / 100.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="280">
          <span class="hits">4</span>
          
          <code class="ruby">    if applied_percentage == 0.0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">      applied_percentage = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    # Apply that percentage to the full_rate</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="285">
          <span class="hits">4</span>
          
          <code class="ruby">    return_rate = full_rate.to_f * applied_percentage.to_f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">    # Round the result</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="288">
          <span class="hits">4</span>
          
          <code class="ruby">    return_rate = return_rate.round</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">  # Assembles the rates for all the services in a particular sub_service_request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">  # Returns a hash of {:service_id =&gt; rate, :service_id =&gt; rate, ...}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  # where :service_id is the id of each service, and the rate is an integer number of cents.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.assemble_ssr_rates_map service_request, sub_service_request_id, funding_source, data_source</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="295">
          <span class="hits">12</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="296">
          <span class="hits">12</span>
          
          <code class="ruby">      organization = PriceGrabber.determine_organization(service_request[&quot;sub_service_requests&quot;][&quot;#{sub_service_request_id}&quot;], data_source)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="297">
          <span class="hits">12</span>
          
          <code class="ruby">      pricing_setup = PriceGrabber.find_pricing_setup(organization)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="298">
          <span class="hits">8</span>
          
          <code class="ruby">      selected_rate_type = PriceGrabber.determine_applicable_rate(pricing_setup, funding_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">      # Collect the line_items that belong to the sub_service_request</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="301">
          <span class="hits">32</span>
          
          <code class="ruby">      ssr_line_items = service_request[&quot;line_items&quot;].select {|li| li[&quot;sub_service_request_id&quot;] == sub_service_request_id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">      # Collect the service_ids for the line_items that belong to the sub_service_request</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="304">
          <span class="hits">22</span>
          
          <code class="ruby">      service_ids = ssr_line_items.map {|li| li[&quot;service_id&quot;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">      # Initialize the empty ssr_rates_hash that will be returned at the completion of the method</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="307">
          <span class="hits">8</span>
          
          <code class="ruby">      ssr_rates_hash = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">      # Iterate over the service_ids and add their rate map to the ssr_rates_hash</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="310">
          <span class="hits">8</span>
          
          <code class="ruby">      service_ids.each do |service_id|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="311">
          <span class="hits">14</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">          # Get the service and its current pricing_map</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="313">
          <span class="hits">14</span>
          
          <code class="ruby">          service = data_source.get(&quot;services/#{service_id}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="314">
          <span class="hits">14</span>
          
          <code class="ruby">          pricing_map = PriceGrabber.find_pricing_map(service)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">          # Determine the rate for the service and add to the ssr_rates_hash</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="317">
          <span class="hits">12</span>
          
          <code class="ruby">          rate = PriceGrabber.determine_rate(pricing_map, pricing_setup, selected_rate_type)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="318">
          <span class="hits">12</span>
          
          <code class="ruby">          ssr_rates_hash[&quot;#{service_id}&quot;] = rate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        rescue ArgumentError =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">          # Should a service lack a pricing map, insert a nil for its rate</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="321">
          <span class="hits">2</span>
          
          <code class="ruby">          if e.message == &quot;Service has no pricing maps!&quot; || e.message == &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="322">
          <span class="hits">2</span>
          
          <code class="ruby">            ssr_rates_hash[&quot;#{service_id}&quot;] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">            raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="329">
          <span class="hits">8</span>
          
          <code class="ruby">      return ssr_rates_hash    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">    # THIS RESCUE BLOCK IS UGLY AND NEEDS TO BE REFACTORED</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="331">
          <span class="hits">4</span>
          
          <code class="ruby">    rescue ArgumentError =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">      # Should an organization lack a pricing_setup assemble the rates map with nil for the service rates</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="333">
          <span class="hits">4</span>
          
          <code class="ruby">      if e.message ==  &quot;Organization has no pricing setups!&quot; || e.message == &quot;Organization has no current pricing setups!&quot; || e.message == &quot;Service has no pricing maps!&quot; || e.message == &quot;Service has no current pricing maps!&quot;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="334">
          <span class="hits">16</span>
          
          <code class="ruby">        ssr_line_items = service_request[&quot;line_items&quot;].select {|li| li[&quot;sub_service_request_id&quot;] == sub_service_request_id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">        # Collect the service_ids for the line_items that belong to the sub_service_request</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="337">
          <span class="hits">14</span>
          
          <code class="ruby">        service_ids = ssr_line_items.map {|li| li[&quot;service_id&quot;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">        # Initialize the empty ssr_rates_hash that will be returned at the completion of the method</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="340">
          <span class="hits">4</span>
          
          <code class="ruby">        ssr_rates_hash = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">        # Iterate over the service_ids and add their rate to the ssr_rates_hash</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="343">
          <span class="hits">4</span>
          
          <code class="ruby">        service_ids.each do |service_id|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="344">
          <span class="hits">10</span>
          
          <code class="ruby">          ssr_rates_hash[&quot;#{service_id}&quot;] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="346">
          <span class="hits">4</span>
          
          <code class="ruby">          return ssr_rates_hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">        raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">  # Determines whether the organization is a program or a core and return the correct one</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.determine_organization object, data_source</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="355">
          <span class="hits">23</span>
          
          <code class="ruby">    organization = case</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">    when object[&quot;core_id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="357">
          <span class="hits">5</span>
          
          <code class="ruby">      PriceGrabber.find_pricing_setup_organization(data_source.get(&quot;cores/#{object[&quot;core_id&quot;]}&quot;), data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">    when object[&quot;program_id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="359">
          <span class="hits">17</span>
          
          <code class="ruby">      PriceGrabber.find_pricing_setup_organization(data_source.get(&quot;programs/#{object[&quot;program_id&quot;]}&quot;), data_source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="362">
          <span class="hits">23</span>
          
          <code class="ruby">    organization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">  # Determines the funding source of a project based on its funding status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">  # Returns the value for the funding or potential funding source as a string</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.determine_funding_source project</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="368">
          <span class="hits">15</span>
          
          <code class="ruby">    funding_source = case project[&quot;funding_status&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">    when &quot;pending_funding&quot; then project[&quot;potential_funding_source&quot;]</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="370">
          <span class="hits">14</span>
          
          <code class="ruby">    when &quot;funded&quot; then project[&quot;funding_source&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="371">
          
          
          <code class="ruby">    else raise ArgumentError, &quot;PROJECT DOES NOT HAVE A FUNDING STATUS&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="374">
          <span class="hits">15</span>
          
          <code class="ruby">    funding_source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">  # Determines the applicable rate that should be charged on a service based on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">  # the funding source of the project and the rates hash of the pricing_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">  # Returns a string of the rate type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.determine_applicable_rate pricing_setup, funding_source</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="381">
          <span class="hits">15</span>
          
          <code class="ruby">    if pricing_setup[&quot;rates&quot;]</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="382">
          <span class="hits">15</span>
          
          <code class="ruby">      selected_rate_type = pricing_setup[&quot;rates&quot;][&quot;#{funding_source}&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="384">
          
          
          <code class="ruby">      raise ArgumentError, &quot;PRICING SETUP DOES NOT HAVE A RATES MAP&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="386">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="387">
          <span class="hits">15</span>
          
          <code class="ruby">    selected_rate_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">  # Retrieves the organization at which the pricing_setup exists, based on a specified</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">  # organization.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">  # Returns an organization hash (either an program or provider).</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_pricing_setup_organization organization, data_source</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="394">
          <span class="hits">29</span>
          
          <code class="ruby">    if organization[&quot;pricing_setups&quot;] &amp;&amp; !organization[&quot;pricing_setups&quot;].empty?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="395">
          <span class="hits">5</span>
          
          <code class="ruby">      return organization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="397">
          <span class="hits">24</span>
          
          <code class="ruby">      if organization[&quot;program_id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="398">
          <span class="hits">5</span>
          
          <code class="ruby">        program = data_source.get(&quot;programs/#{organization[&#39;program_id&#39;]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="399">
          <span class="hits">5</span>
          
          <code class="ruby">        return PriceGrabber.find_pricing_setup_organization(program, data_source)</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="400">
          <span class="hits">19</span>
          
          <code class="ruby">      elsif organization[&quot;provider_id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="401">
          <span class="hits">19</span>
          
          <code class="ruby">        provider = data_source.get(&quot;providers/#{organization[&#39;provider_id&#39;]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="402">
          <span class="hits">19</span>
          
          <code class="ruby">        return provider</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="404">
          
          
          <code class="ruby">        raise ArgumentError, &quot;NO PARENT ID FOUND ON ORGANIZATION&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">  # Assemble the calculated rates for a service based on a specific pricing_map</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">  # and pricing_setup.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">  # Returns a hash of rates (as described in the rates_on_date method).</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.assemble_all_rates_map pricing_map, pricing_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">      &quot;full_rate&quot; =&gt; pricing_map[&quot;full_rate&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">      &quot;federal_rate&quot; =&gt; PriceGrabber.calculate_rate(pricing_map, pricing_setup, &#39;federal_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">      &quot;corporate_rate&quot; =&gt; PriceGrabber.calculate_rate(pricing_map, pricing_setup, &#39;corporate_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby">      &quot;other_rate&quot; =&gt; PriceGrabber.calculate_rate(pricing_map, pricing_setup, &#39;other_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">      &quot;member_rate&quot; =&gt; PriceGrabber.calculate_rate(pricing_map, pricing_setup, &#39;member_rate&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">  # Assemble the calculated rates for a service based on a specific full_rate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">  # and pricing_setup.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">  # Returns a hash of rates (as described in the rates_on_date method).</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.assemble_rates_from_full full_rate, pricing_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">      &quot;federal_rate&quot; =&gt; PriceGrabber.calculate_off_full(full_rate, pricing_setup, &#39;federal_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">      &quot;corporate_rate&quot; =&gt; PriceGrabber.calculate_off_full(full_rate, pricing_setup, &#39;corporate_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">      &quot;other_rate&quot; =&gt; PriceGrabber.calculate_off_full(full_rate, pricing_setup, &#39;other_rate&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">      &quot;member_rate&quot; =&gt; PriceGrabber.calculate_off_full(full_rate, pricing_setup, &#39;member_rate&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0d4c2a7ccde40ea806f2c5bca7a883aa4081d2e5">
  <div class="header">
    <h3>lib/price_grabber/business.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module PriceGrabber::Business</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.per_unit_cost(pricing_map, rate, quantity_total)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="4">
          <span class="hits">26</span>
          
          <code class="ruby">    if quantity_total == 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="7">
          <span class="hits">25</span>
          
          <code class="ruby">      unit_factor = pricing_map[&quot;unit_factor&quot;]</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="8">
          <span class="hits">25</span>
          
          <code class="ruby">      units_per_package = unit_factor || 1</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="9">
          <span class="hits">25</span>
          
          <code class="ruby">      packages_we_have_to_get = (quantity_total.to_f / units_per_package.to_f).ceil</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="10">
          <span class="hits">25</span>
          
          <code class="ruby">      total_cost = packages_we_have_to_get.to_f * rate.to_f</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="11">
          <span class="hits">25</span>
          
          <code class="ruby">      ret_cost = total_cost / quantity_total.to_f</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="12">
          <span class="hits">25</span>
          
          <code class="ruby">      ret_cost</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Returns a list of subtotals for the visits in the line item.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # Visit totals depend on the quantities in the other visits so</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  # it would be clunky to compute one visit at a time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.per_subject_subtotals(line_item, rate, pricing_map)</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="20">
          <span class="hits">198</span>
          
          <code class="ruby">    visits_array = line_item[&quot;visits&quot;].collect{ |x| x[&#39;billing&#39;] == &quot;R&quot; ? x : nil}.compact</code>
        </li>
      
        <li class="covered" data-hits="103" data-linenumber="21">
          <span class="hits">103</span>
          
          <code class="ruby">    quantity_array = visits_array.collect { |x| x[&#39;quantity&#39;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="23">
          <span class="hits">18</span>
          
          <code class="ruby">    if rate == &quot;N/A&quot;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="24">
          <span class="hits">11</span>
          
          <code class="ruby">      totals_array = line_item[&quot;visits&quot;].map { |x| x = &quot;N/A&quot; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      totals_array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="27">
          <span class="hits">17</span>
          
          <code class="ruby">    elsif quantity_array != []</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="28">
          <span class="hits">16</span>
          
          <code class="ruby">      print quantity_array</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="29">
          <span class="hits">16</span>
          
          <code class="ruby">      quantity_total = quantity_array.inject(:+) * line_item[&quot;subject_count&quot;]</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="30">
          <span class="hits">16</span>
          
          <code class="ruby">      unit_cost = per_unit_cost(pricing_map, rate, quantity_total)</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="31">
          <span class="hits">96</span>
          
          <code class="ruby">      totals_array = quantity_array.collect{ |x| x * unit_cost }</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="32">
          <span class="hits">16</span>
          
          <code class="ruby">      totals_array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="35">
          <span class="hits">11</span>
          
          <code class="ruby">      totals_array = line_item[&quot;visits&quot;].map { |x| x = 0 }  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      totals_array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.indirect_cost_rate(indirect_cost_rate)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="41">
          <span class="hits">9</span>
          
          <code class="ruby">    indirect_cost_rate.to_f / 100.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.direct_costs_for_visit_based_service(line_item, rate, pricing_map)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="45">
          <span class="hits">14</span>
          
          <code class="ruby">    subject_totals = (per_subject_subtotals(line_item, rate, pricing_map)).inject(:+)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="46">
          <span class="hits">14</span>
          
          <code class="ruby">    line_item[&quot;subject_count&quot;] * subject_totals</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # Determine the direct costs for a one time fee</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.direct_costs_for_one_time_fee(line_item, rate, pricing_map)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">    quantity = line_item[&quot;quantity&quot;]</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="52">
          <span class="hits">8</span>
          
          <code class="ruby">    units_per_quantity = line_item[&quot;units_per_quantity&quot;]</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="53">
          <span class="hits">8</span>
          
          <code class="ruby">    total = quantity * units_per_quantity</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">    total * per_unit_cost(pricing_map, rate, total)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.indirect_costs_for_visit_based_service(indirect_cost_rate, line_item, rate, pricing_map)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="58">
          <span class="hits">7</span>
          
          <code class="ruby">    direct_costs_for_visit_based_service(line_item, rate, pricing_map) * indirect_cost_rate(indirect_cost_rate)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.indirect_costs_for_one_time_fee(indirect_cost_rate, line_item, rate, pricing_map)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">    if pricing_map[&quot;exclude_from_indirect_cost&quot;]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="63">
          <span class="hits">7</span>
          
          <code class="ruby">      0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      direct_costs_for_one_time_fee(line_item, rate, pricing_map) * indirect_cost_rate(indirect_cost_rate)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # Return value is a map</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.total_totals(indirect_cost_rate, line_items_with_rates_and_pricing_maps)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="71">
          <span class="hits">14</span>
          
          <code class="ruby">    one_time_fees, visit_based = line_items_with_rates_and_pricing_maps.partition { |x| x[&#39;pricing_map&#39;][&#39;is_one_time_fee&#39;] == true }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="73">
          <span class="hits">2</span>
          
          <code class="ruby">    indirect_otf = direct_otf = indirect_vbs = direct_vbs = 0.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="75">
          <span class="hits">2</span>
          
          <code class="ruby">    one_time_fees.each do |otf|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="76">
          <span class="hits">6</span>
          
          <code class="ruby">      indirect_otf += indirect_costs_for_one_time_fee(indirect_cost_rate, otf[&quot;line_item&quot;], otf[&quot;rate&quot;], otf[&quot;pricing_map&quot;])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="77">
          <span class="hits">6</span>
          
          <code class="ruby">      direct_otf += direct_costs_for_one_time_fee(otf[&quot;line_item&quot;], otf[&quot;rate&quot;], otf[&quot;pricing_map&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="80">
          <span class="hits">2</span>
          
          <code class="ruby">    visit_based.each do |vb|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="81">
          <span class="hits">6</span>
          
          <code class="ruby">      indirect_vbs += indirect_costs_for_visit_based_service(indirect_cost_rate, vb[&quot;line_item&quot;], vb[&quot;rate&quot;], vb[&quot;pricing_map&quot;])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="82">
          <span class="hits">6</span>
          
          <code class="ruby">      direct_vbs += direct_costs_for_visit_based_service(vb[&quot;line_item&quot;], vb[&quot;rate&quot;], vb[&quot;pricing_map&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">    direct = direct_vbs + direct_otf</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="86">
          <span class="hits">2</span>
          
          <code class="ruby">    indirect = indirect_vbs + indirect_otf</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="87">
          <span class="hits">2</span>
          
          <code class="ruby">    total = direct + indirect</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="88">
          <span class="hits">2</span>
          
          <code class="ruby">    {&quot;direct&quot; =&gt; direct, &quot;indirect&quot; =&gt; indirect, &quot;total&quot; =&gt; total}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.calculate_subsidy_percentage(pi_contribution, total)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">    funded_amount = total - pi_contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    ((funded_amount.to_f / total.to_f).round(2) * 100).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.calculate_pi_contribution(subsidy_percentage, total)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">    contribution = total * (subsidy_percentage.to_f / 100.0)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">    contribution = total - contribution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">    contribution.ceil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ba547746737de30efcb274de5e972dc5863062f9">
  <div class="header">
    <h3>lib/price_grabber/common.rb</h3>
    <h4><span class="green">93.75 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;rest_client&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber/config&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PriceGrabber::Common</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  COMMON_URL = PriceGrabber::Config::OBIS_ENTITY_URL + &#39;/obisentity/&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  SIMPLE_URL = PriceGrabber::Config::OBIS_ENTITY_URL + &#39;/obissimple/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  URL_FOR = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    :simple =&gt; SIMPLE_URL,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    :full =&gt; COMMON_URL,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.url_for entity_type, interface=:simple</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="16">
          <span class="hits">7</span>
          
          <code class="ruby">    URL_FOR[interface] + entity_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get entity_type, interface=:simple, &amp;block</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">    entities = JSON.parse(RestClient.get(url_for(entity_type, interface)))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="22">
          <span class="hits">4</span>
          
          <code class="ruby">    if block_given?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">      filtered_entities = yield entities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="26">
          <span class="hits">4</span>
          
          <code class="ruby">    filtered_entities || entities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # def self.put entity, entity_type, interface=:simple</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  #   if interface == :simple</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  #     id_key = &quot;id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #   elsif interface == :full</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  #     id_key = &quot;_id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  #   begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  #     RestClient.put(&quot;#{url_for(entity_type, interface)}/#{entity[id_key]}&quot;, entity.to_json, :content_type =&gt; :json)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  #   rescue Exception =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  #     puts e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  #     puts(&quot;ERROR:&quot; + e.response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  #     raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.logger message, data_source</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    p message if data_source == Common</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a05a477425e7d218e860945f0b5382e916d107be">
  <div class="header">
    <h3>lib/price_grabber/config.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;yaml&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module PriceGrabber::Config</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  @environment = ENV[&#39;RACK_ENV&#39;] || &#39;development&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  BASE = Dir.pwd</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  @@yaml = YAML.load_file(BASE + &quot;/config/application.yml&quot;)[@environment]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  OBIS_ENTITY_URL = @@yaml[&quot;obis_common_url&quot;].to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e83a158da22654039fa2728c51ad12513ab4616d">
  <div class="header">
    <h3>spec/common_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber/config&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber/common&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Common module&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before :each do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;Building URLs&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should build a url given an entity type and no interface&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.url_for(&#39;services&#39;).should eq(&#39;http://localhost:4567/obissimple/services&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should build a url given an entity type and an interface&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.url_for(&#39;services&#39;, :full).should eq(&#39;http://localhost:4567/obisentity/services&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should buld a url given a specific entity and no interface&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.url_for(&#39;services/abc123&#39;).should eq(&#39;http://localhost:4567/obissimple/services/abc123&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;Getting entities&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;from simple&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return an array of entities for the given entity type with no block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        RestClient.stub(:get).with(&#39;http://localhost:4567/obissimple/services&#39;).and_return(&quot;[{\&quot;name\&quot;:\&quot;Blood Transfusion\&quot;}]&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.get(&#39;services&#39;).first[&quot;name&quot;].should eq(&quot;Blood Transfusion&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return an array of filterd entities when a block is provided&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        RestClient.stub(:get).with(&#39;http://localhost:4567/obissimple/services&#39;).and_return(&quot;[{\&quot;name\&quot;:\&quot;Blood Transfusion\&quot;}, {\&quot;name\&quot;:\&quot;Spinal Tap\&quot;}]&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">        ret = PriceGrabber::Common.get(&#39;services&#39;) {|x| x.select {|y| y[&quot;name&quot;] == &quot;Spinal Tap&quot;}}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.count.should eq(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;from full&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return an array of valid entity hashes when given an entity type&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        RestClient.stub(:get).with(&#39;http://localhost:4567/obisentity/services&#39;).and_return(&quot;[{\&quot;attributes\&quot;:{\&quot;name\&quot;:\&quot;Blood Transfusion\&quot;}}]&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.get(&#39;services&#39;, :full).first[&quot;attributes&quot;][&quot;name&quot;].should eq(&quot;Blood Transfusion&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return an array of filtered, full entities when a block is provided&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">        RestClient.stub(:get).with(&#39;http://localhost:4567/obisentity/services&#39;).and_return(&quot;[{\&quot;attributes\&quot;:{\&quot;name\&quot;:\&quot;Blood Transfusion\&quot;}}, {\&quot;attributes\&quot;:{\&quot;name\&quot;:\&quot;Spinal Tap\&quot;}}]&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">        ret = PriceGrabber::Common.get(&#39;services&#39;, :full) {|x| x.select {|y| y[&quot;attributes&quot;][&quot;name&quot;] == &quot;Spinal Tap&quot;}}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.count.should eq(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f28ab6f6a399bfd5f6a61195dec4bc28a528262b">
  <div class="header">
    <h3>spec/get_service_rate_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>124</b> relevant lines. 
      <span class="green"><b>124</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Get service rate method&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  context :success do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with a current pricing_map and a current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      context :funded_project do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        context :program_based_service do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">          it &quot;should return the rate when the pricing_setup is on the provider&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">            provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">            program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">            program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">            service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">            project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">            ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">            ret.should eq(11111)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">          it &quot;should return the rate when the pricing_setup is on the program&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">            provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">            provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">            program = Fixtures::PROGRAM</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">            service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;foundation&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">            ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">            ret.should eq(41666)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">        context :core_based_service do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">          it &quot;should return the rate when the pricing_setup is on the provider&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">            provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">            program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">            program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">            core = Fixtures::CORE</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">            service = Fixtures::SERVICE.merge({&quot;core_id&quot; =&gt; core[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">            project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;cores/GHI789&#39;).and_return(core)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">            ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">            ret.should eq(11111)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">        context :different_funding_sources do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">          before :each do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="77">
          <span class="hits">2</span>
          
          <code class="ruby">            @provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="78">
          <span class="hits">2</span>
          
          <code class="ruby">            @program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="79">
          <span class="hits">2</span>
          
          <code class="ruby">            @program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="80">
          <span class="hits">2</span>
          
          <code class="ruby">            @service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; @program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="81">
          <span class="hits">2</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(@provider)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="82">
          <span class="hits">2</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(@program)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="83">
          <span class="hits">2</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(@service)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">          it &quot;should return the correct rate for a project with investigator funding&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">            project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;investigator&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">            ret = PriceGrabber.get_service_rate(@service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">            ret.should eq(16667)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">          it &quot;should return the correct rate for a project with college funding&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">            project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;college&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">            PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">            ret = PriceGrabber.get_service_rate(@service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            ret.should eq(55555)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">      context :pending_funding_project do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the rate map for the service in question&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::PENDING_PROJECT.merge(&quot;potential_funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5001&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(11111)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with a current pricing_map and no current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;there is an overridden rate value for the rate in question&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the rate for the service&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;internal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(43434)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">  context :failure do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with a current pricing_map and no current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;there is no overridden rate value for the rate in question&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return an empty rate&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">          provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;internal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with no current pricing_map and a current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should raise an exception&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">        provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">        provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">        program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">        program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        service = Fixtures::SERVICE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">        service.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">        service.delete(&#39;pricing_maps&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">        project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;internal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="201">
          <span class="hits">2</span>
          
          <code class="ruby">        lambda { PriceGrabber.get_service_rate(service[&quot;id&quot;], project[&quot;id&quot;]) }.should raise_exception(ArgumentError, &quot;Service has no pricing maps!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1b39cbb93f40cde59a02bcd887e446c4669ccb74">
  <div class="header">
    <h3>spec/get_service_request_rates_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>107</b> relevant lines. 
      <span class="green"><b>107</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Get service-request service rates method&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  context :success do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;all services have current pricing_maps and current pricing_setups&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should get a collection of rate maps for the services&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">        program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">        program2 = Fixtures::PROGRAM2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">        core = Fixtures::CORE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        core[&quot;program_id&quot;] = program2[&quot;id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">        service3 = Fixtures::SERVICE3.merge({&quot;core_id&quot; =&gt; core[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">        service_request = Fixtures::MULTI_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/ZZZ999&#39;).and_return(program2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;cores/GHI789&#39;).and_return(core)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRMULTI&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        ret = PriceGrabber.get_service_request_rates(service_request[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">          {&quot;111&quot; =&gt; 11111,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">           &quot;222&quot; =&gt; 9135,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">           &quot;333&quot; =&gt; 27909</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  context :failure do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with a current pricing_map and no current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should get a collection of rate maps for the services&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">        provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">        program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">        program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        program2 = Fixtures::PROGRAM2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">        core = Fixtures::CORE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">        core[&quot;program_id&quot;] = program2[&quot;id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        service3 = Fixtures::SERVICE3.merge({&quot;core_id&quot; =&gt; core[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">        service_request = Fixtures::MULTI_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">        project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/ZZZ999&#39;).and_return(program2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;cores/GHI789&#39;).and_return(core)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRMULTI&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">        ret = PriceGrabber.get_service_request_rates(service_request[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          {&quot;111&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">           &quot;222&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">           &quot;333&quot; =&gt; 27909</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with no current pricing_map&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;has a current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the service_request_rates_map with the bad service as nil&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">          program2 = Fixtures::PROGRAM2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">          core = Fixtures::CORE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">          core[&quot;program_id&quot;] = program2[&quot;id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">          service3 = Fixtures::SERVICE3.merge({&quot;core_id&quot; =&gt; core[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">          service3.delete(&quot;pricing_maps&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">          service_request = Fixtures::MULTI_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/ZZZ999&#39;).and_return(program2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;cores/GHI789&#39;).and_return(core)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRMULTI&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_service_request_rates(service_request[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">            {&quot;111&quot; =&gt; 11111,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">             &quot;222&quot; =&gt; 9135,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">             &quot;333&quot; =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;has no current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the service_request_rates_map with the bad service as nil&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">          provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          program2 = Fixtures::PROGRAM2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">          core = Fixtures::CORE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">          core[&quot;program_id&quot;] = program2[&quot;id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">          service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">          service2.delete(&#39;pricing_maps&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">          service3 = Fixtures::SERVICE3.merge({&quot;core_id&quot; =&gt; core[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">          service_request = Fixtures::MULTI_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/ZZZ999&#39;).and_return(program2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;cores/GHI789&#39;).and_return(core)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRMULTI&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_service_request_rates(service_request[&quot;id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            {&quot;111&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">             &quot;222&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">             &quot;333&quot; =&gt; 27909</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="affa4b85a5752db87f066c94e40508e784f4eb25">
  <div class="header">
    <h3>spec/get_ssr_rates_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>89</b> relevant lines. 
      <span class="green"><b>89</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Get sub-service-request service rates method&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  context :success do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;all services have current pricing_maps and current pricing_setups&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should get a collection of rate maps for the services&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">        program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">        service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">        service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        service3 = Fixtures::SERVICE3.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        service_request = Fixtures::BIG_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRBIG&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        ret = PriceGrabber.get_ssr_rates(service_request[&quot;id&quot;], &quot;0003&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          {&quot;111&quot; =&gt; 11111,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">           &quot;222&quot; =&gt; 9135,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">           &quot;333&quot; =&gt; 6490</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  context :failure do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with a current pricing_map and no current pricing_setup&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return an empty rate_map&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">        provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">        program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">        service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">        service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        service3 = Fixtures::SERVICE3.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">        service_request = Fixtures::BIG_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">        project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRBIG&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">        PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        ret = PriceGrabber.get_ssr_rates(service_request[&quot;id&quot;], &quot;0003&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          {&quot;111&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">           &quot;222&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">           &quot;333&quot; =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;service with no current pricing_map&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;has a current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the ssr_rates_hash with the bad service as nil&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">          service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">          service3 = Fixtures::SERVICE3.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">          service3.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">          service3.delete(&quot;pricing_maps&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">          service_request = Fixtures::BIG_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRBIG&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_ssr_rates(service_request[&quot;id&quot;], &quot;0003&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">            {&quot;111&quot; =&gt; 11111,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">             &quot;222&quot; =&gt; 9135,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">             &quot;333&quot; =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;has no current pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">        it &quot;should return the nil&#39;d out ssr_rates_map with the bad service as full nil&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">          provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">          program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">          service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">          service2 = Fixtures::SERVICE2.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">          service3 = Fixtures::SERVICE3.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">          service3.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">          service3.delete(&quot;pricing_maps&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">          service_request = Fixtures::BIG_SERVICE_REQUEST</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">          project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;federal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/222&#39;).and_return(service2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;services/333&#39;).and_return(service3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;service_requests/SRBIG&#39;).and_return(service_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">          PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          ret = PriceGrabber.get_ssr_rates(service_request[&quot;id&quot;], &quot;0003&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">          ret.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">            {&quot;111&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">             &quot;222&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">             &quot;333&quot; =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b3dc88bdf5df771558108802bc87c2f3a275e80c">
  <div class="header">
    <h3>spec/price_grabber_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>41</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Pricegrabber method general methods&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  context :find_pricing_map do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;when not supplied with a date&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return the service&#39;s current pricing map&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_map = PriceGrabber.find_pricing_map(Fixtures::SERVICE)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_map[&quot;effective_date&quot;].should eq(&quot;2012-05-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should raise an error if it cannot find a pricing map&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        service_copy = Fixtures::SERVICE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        service_copy.delete(&quot;pricing_maps&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">        lambda { PriceGrabber.find_pricing_map(service_copy) }.should raise_exception(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should raise an error if there are no current pricing maps&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">        service_copy = Fixtures::SERVICE.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">        service_copy[&quot;pricing_maps&quot;] = [Fixtures::SERVICE[&quot;pricing_maps&quot;].last]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">        lambda { PriceGrabber.find_pricing_map(service_copy) }.should raise_exception(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;when supplied with a date&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return the pricing map displayed on that date&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_map = PriceGrabber.find_pricing_map(Fixtures::SERVICE, &quot;2500-01-01&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_map[&quot;display_date&quot;].should eq(&#39;2100-01-01&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  context :find_pricing_setup do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;when not supplied with a date&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return a provider&#39;s displayed pricing setup&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup = PriceGrabber.find_pricing_setup(Fixtures::PROVIDER)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup[&quot;display_date&quot;].should eq(&quot;2012-05-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return a program&#39;s displayed pricing setup&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup = PriceGrabber.find_pricing_setup(Fixtures::PROGRAM)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup[&quot;display_date&quot;].should eq(&#39;2012-06-01&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should raise an error if it cannot find a pricing setup&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        provider_copy = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">        provider_copy.delete(&quot;pricing_setups&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">        lambda { PriceGrabber.find_pricing_setup(provider_copy) }.should raise_exception(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should raise an error if there are no current pricing setups&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">        provider_copy = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">        provider_copy[&quot;pricing_setups&quot;] = [Fixtures::PROVIDER[&quot;pricing_setups&quot;].last]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="64">
          <span class="hits">2</span>
          
          <code class="ruby">        lambda { PriceGrabber.find_pricing_setup(provider_copy) }.should raise_exception(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;when supplied with a date&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      it &quot;should return the pricing setup displayed on that date&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup = PriceGrabber.find_pricing_setup(Fixtures::PROVIDER, &#39;2500-01-01&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">        pricing_setup[&quot;display_date&quot;].should eq(&quot;2100-01-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="844c6afbf498084c2b84af21047d648885d045fd">
  <div class="header">
    <h3>spec/rates_on_date_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>51</b> relevant lines. 
      <span class="green"><b>51</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fixtures&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;price_grabber&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Get rates on a particular date method&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;there is a valid pricing setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should return a hash of the rates at a particular date&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      rates = PriceGrabber.rates_on_date(service[&quot;id&quot;], &quot;2500-01-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      rates.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        {&quot;full_rate&quot;      =&gt; 99999,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">         &quot;federal_rate&quot;   =&gt; 88999,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">         &quot;corporate_rate&quot; =&gt; 45000,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">         &quot;other_rate&quot;     =&gt; 23000,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">         &quot;member_rate&quot;    =&gt; 55999</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;there is no valid pricing setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should return the nil hash&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      service = Fixtures::SERVICE.merge({&quot;program_id&quot; =&gt; program[&quot;id&quot;]})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      project = Fixtures::FUNDED_PROJECT.merge(&quot;funding_source&quot; =&gt; &quot;internal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;services/111&#39;).and_return(service)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;projects/5000&#39;).and_return(project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      rates = PriceGrabber.rates_on_date(service[&quot;id&quot;], &quot;2500-01-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      rates.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">        {&quot;full_rate&quot;      =&gt; 99999,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">         &quot;federal_rate&quot;   =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">         &quot;corporate_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">         &quot;other_rate&quot;     =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">         &quot;member_rate&quot;    =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;calculate rates based on a passed in full_rate&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;there is a valid pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should return a hash of the rates at a particular date&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">      provider = Fixtures::PROVIDER</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;entities/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">      rates = PriceGrabber.rates_from_full(10000, program[&quot;id&quot;], &quot;2500-01-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      rates.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">         {&quot;federal_rate&quot;   =&gt; 8900,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">         &quot;corporate_rate&quot; =&gt; 4500,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">         &quot;other_rate&quot;     =&gt; 2300,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">         &quot;member_rate&quot;    =&gt; 5600</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;there is no valid pricing_setup&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;should return the nil hash&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">      provider = Fixtures::PROVIDER.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">      provider.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">      program = Fixtures::PROGRAM.clone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      program.delete(&#39;pricing_setups&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;providers/ABC123&#39;).and_return(provider)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;programs/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">      PriceGrabber::Common.stub(:get).with(&#39;entities/DEF456&#39;).and_return(program)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">      rates = PriceGrabber.rates_from_full(10000, program[&quot;id&quot;], &quot;2500-01-01&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">      rates.should eq(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">        {&quot;federal_rate&quot;   =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">         &quot;corporate_rate&quot; =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">         &quot;other_rate&quot;     =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">         &quot;member_rate&quot;    =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
